# -*- coding: utf-8 -*-
"""customer_churn_prediction.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14iwi-ZXDp2lvdwXIvMqhakLqGWBGB8Q-
"""

import numpy as np
import pandas as pd
import sklearn
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.preprocessing import LabelEncoder
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import classification_report
from sklearn.linear_model import LogisticRegression
from sklearn.model_selection import train_test_split

df = pd.read_csv("churn.csv")
df

df.shape

df.columns.values

df.isna().sum()

df.describe()

df['Churn'].value_counts()

sns.countplot(df['Churn'])

numRetained = df[df.Churn == 'No'].shape[0]
numChurned = df[df.Churn == 'Yes'].shape[0]

# print the percentage of customers that stayed
print(numRetained/(numRetained + numChurned) * 100,'% of customers stayed in the company')
# peint the percentage of customers that left
print(numChurned/(numRetained + numChurned) * 100, '% of customers left with the company')

sns.countplot(x ='gender', hue='Churn', data=df)

sns.countplot(x='InternetService', hue='Churn', data=df)

numericFeatures = ['tenure', 'MonthlyCharges']
fig, ax = plt.subplots(1,2, figsize=(28, 8))
df[df.Churn == "No"][numericFeatures].hist(bins=20, color='blue', alpha=0.5, ax=ax)
df[df.Churn == "Yes"][numericFeatures].hist(bins=20, color='orange', alpha=0.5, ax=ax)

cleanDF = df.drop('customerID', axis=1)

for column in cleanDF.columns:
  if cleanDF[column].dtype == np.number:
    continue
  cleanDF[column] = LabelEncoder().fit_transform(cleanDF[column])

cleanDF.dtypes

x = cleanDF.drop('Churn', axis=1)
y = cleanDF['Churn']
x = StandardScaler().fit_transform(x)

xtrain, xtest, ytrain, ytest = train_test_split(x,y, test_size=0.2, random_state=42)

model = LogisticRegression(class_weight='balanced')
# Train the model
model.fit(xtrain, ytrain)

predictions = model.predict(xtest)

# print the predictions
print(predictions)

print(classification_report(ytest, predictions))